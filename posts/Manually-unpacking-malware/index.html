<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Manually Unpacking Malware" /><meta name="author" content="Travis Mathison" /><meta property="og:locale" content="en" /><meta name="description" content="Intro This post is intended to show one technique that can be used in an attempt to unpack a sample that is suspected to be packed by either a known packer or something unknown or even custom." /><meta property="og:description" content="Intro This post is intended to show one technique that can be used in an attempt to unpack a sample that is suspected to be packed by either a known packer or something unknown or even custom." /><link rel="canonical" href="https://tdmathison.github.io/posts/Manually-unpacking-malware/" /><meta property="og:url" content="https://tdmathison.github.io/posts/Manually-unpacking-malware/" /><meta property="og:site_name" content="Travis Mathison" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-23T12:36:00-08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Manually Unpacking Malware" /><meta name="twitter:site" content="@ciph34block" /><meta name="twitter:creator" content="@Travis Mathison" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Travis Mathison"},"description":"Intro This post is intended to show one technique that can be used in an attempt to unpack a sample that is suspected to be packed by either a known packer or something unknown or even custom.","url":"https://tdmathison.github.io/posts/Manually-unpacking-malware/","@type":"BlogPosting","headline":"Manually Unpacking Malware","dateModified":"2020-12-03T10:46:14-08:00","datePublished":"2020-11-23T12:36:00-08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://tdmathison.github.io/posts/Manually-unpacking-malware/"},"@context":"https://schema.org"}</script><title>Manually Unpacking Malware | Travis Mathison</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Travis Mathison"><meta name="application-name" content="Travis Mathison"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Travis Mathison</a></div><div class="site-subtitle font-italic">Malware Reverse Engineering and Threat Research.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/resources/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>RESOURCES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/tdmathison" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/ciph34block" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/travismathison/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Manually Unpacking Malware</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Manually Unpacking Malware</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Travis Mathison </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Nov 23, 2020, 12:36 PM -0800" >Nov 23, 2020<i class="unloaded">2020-11-23T12:36:00-08:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Dec 3, 2020, 10:46 AM -0800" >Dec 3, 2020<i class="unloaded">2020-12-03T10:46:14-08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1463 words">8 min read</span></div></div><div class="post-content"><h2 id="intro">Intro</h2><p>This post is intended to show one technique that can be used in an attempt to unpack a sample that is suspected to be packed by either a known packer or something unknown or even custom.</p><p>There are many techniques that can be used and malware may dictate what works and what does not work. I found that this technique seems to be an easy first pass for any given packer as a first step (outside of having the packer/unpacker tool to properly unpack). The intent here is to show a way to do it when that is not feasible.</p><h2 id="the-malware-sample-used-in-this-blog-post">The malware sample used in this blog post</h2><ul><li>MD5 hash: <code class="language-plaintext highlighter-rouge">5B47FBC2DA1868022F30317EC7DDA39F</code><li>VirusTotal link to sample: <a href="https://www.virustotal.com/gui/file/1bb8c898b249c47249c31d9901b12add9d307f027e5cbff97937769d7e5c732e/detection">https://www.virustotal.com/gui/file/1bb8c898b249c47249c31d9901b12add9d307f027e5cbff97937769d7e5c732e/detection</a></ul><h2 id="in-brief-what-is-a-packer">In brief: what is a packer?</h2><p>The term “packer” has changed over the years and can be used to mean many different things now. The three main categories of tools in this area are called packers, crypters, and protectors.</p><p>For the purpose of this post I am refering to packer to be described as:</p><blockquote><p>A tool that compresses, encrypts, and/or modifies the bytes of a file to effectively obfuscate it and make it harder to statically analyze and reverse engineer.</p></blockquote><p>A few of the popular packers for malware are: UPX, ASPack, Themida, Exe Packer, MPRESS, Morphine, and others.</p><h2 id="how-to-know-a-malicious-binary-is-packed">How to know a malicious binary is packed?</h2><p>There are a few key indicators that you can use to make this determination pretty quickly: section names and sections being executable when they shouldn’t be, high entropy values and a mostly missing Import Table, odd entry points, to name a few.</p><h3 id="section-names">Section Names</h3><p>Most packers will create their own section names within the binary. In the case of UPX (used in this sample) you will see PE section names of <code class="language-plaintext highlighter-rouge">UPX0</code> and <code class="language-plaintext highlighter-rouge">UPX1</code>. For MPRESS you may see <code class="language-plaintext highlighter-rouge">.MPRESS1</code> and <code class="language-plaintext highlighter-rouge">.MPRESS2</code>. For VMProtect it creates sections named <code class="language-plaintext highlighter-rouge">.vmp0</code>, <code class="language-plaintext highlighter-rouge">.vmp1</code> and <code class="language-plaintext highlighter-rouge">.vmp2</code>.</p><p>You can perform a quick Internet search on the section names to help identify what it may be associated to as most are well-known.</p><h3 id="entropy-values">Entropy Values</h3><p>The entopy of a file is essentially an indicator of the randomness of the characters in the file. When a file has been compressed or encrypted it will have a high value of 7 or 8. Conversely, if it appears to be plaintext it will have a low entropy value.</p><p>Using the <a href="https://github.com/horsicq/Detect-It-Easy">Detect It Easy</a> tool you can see the entropy of the <code class="language-plaintext highlighter-rouge">UPX0</code> and <code class="language-plaintext highlighter-rouge">UPX1</code> sections within the malware sample:<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_entropy.png" /></p><h3 id="import-table">Import Table</h3><p>The Import Table of the file may look as though very few functions are being imported and used. This may simply be due to the packed file hiding most of the functions and only leaving behind what is needed during the unpacking process.</p><p>Additionally, some key indicators of left over functions that are very commonly used during unpacking or resolving obfuscated functions are: <code class="language-plaintext highlighter-rouge">VirtualProtect</code>, <code class="language-plaintext highlighter-rouge">GetProcAddress</code>, and <code class="language-plaintext highlighter-rouge">LoadLibraryA</code>. And sure enough, when we look at the sample in the <a href="https://ntcore.com/?page_id=388">CFF Explorer</a> tool…<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_importtable_packed.png" /></p><h3 id="tools-that-do-it-for-you">Tools that do it for you</h3><p>Lastly, there are many tools that will go through and check these sorts of indicator and present you with their findings. The most popular tool is probably the <a href="https://www.aldeid.com/wiki/PEiD">PEiD</a> tool which clearly shows our binary as UPX packed as seen below:<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_peid_upx_packed.png" /></p><h2 id="preparing-windows-to-adhere-to-dep-protection">Preparing Windows to adhere to DEP protection</h2><p>By default, Windows 10 only turns on Data Execution Prevention (DEP) for “essential Windows programs and services only”. You need to change this to be “all programs and services” so that Windows will prevent the malware from executing code in sections that are not marked Executable.</p><ol><li>In the Windows Control Panel, search for “view advanced system settings”<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_adv_sys_settings.png" /><li>Select the Advanced tab<li>Click Performance-&gt;Settings<li>Select the Data Execution Prevention tab<li>Select the radial option to enable DEP for all applications <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_turn_dep_on.png" /><br /><li>Reboot your VM for the setting to take affect</ol><h2 id="manual-unpacking-steps">Manual Unpacking Steps</h2><h3 id="opening-malware-sample-in-immunity-debugger">Opening malware sample in Immunity Debugger</h3><ol><li>Open Immunity Debugger and hit <code class="language-plaintext highlighter-rouge">F3</code> to open a dialog to select the malware file to open<li>The file will load and break at what it believes to be the Module Entry Point (this is the beginning of the unpacker code in this case)<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_immdbg_01.png" /><br /></ol><h3 id="observe-the-upx-sections">Observe the UPX sections</h3><ol><li>Press <code class="language-plaintext highlighter-rouge">ALT+M</code> to identify the <code class="language-plaintext highlighter-rouge">UPX0</code> and <code class="language-plaintext highlighter-rouge">UPX1</code> sections. Note that both of these sections have access level <code class="language-plaintext highlighter-rouge">RWE</code> (Read/Write/Execute)<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_immdbg_02.png" /><br /><li>If you double-click on the <code class="language-plaintext highlighter-rouge">UPX0</code> section a dump window will show that the section is simply a placeholder for the decoded bytes<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_immdbg_03.png" /><br /><li>If you double-click the <code class="language-plaintext highlighter-rouge">UPX1</code> section you will see the UPX unpacking routine that will write the decoded bytes into the <code class="language-plaintext highlighter-rouge">UPX0</code> section<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_immdbg_04.png" /><br /></ol><h3 id="remove-execute-permission-from-the-upx0-section">Remove Execute permission from the UPX0 section</h3><p>Before we attempt to let the malware unpack itself we need to setup a way for it to stop execution upon finishing its unpacking routine. To do this we will set the <code class="language-plaintext highlighter-rouge">UPX0</code> section that it is writing bytes to, to <code class="language-plaintext highlighter-rouge">RW</code> as opposed to <code class="language-plaintext highlighter-rouge">RWE</code>. This should cause an Access Violation once it attempts to pass control to the newly unpacked code.</p><ol><li>Change the <code class="language-plaintext highlighter-rouge">UPX0</code> section to <code class="language-plaintext highlighter-rouge">RW</code><br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_immdbg_05.png" /><br /></ol><p>The updated permissions should look like the following now:<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_immdbg_06.png" /><br /></p><h3 id="catching-virtualprotect-calls">Catching VirtualProtect calls</h3><p>Malware will also attempt to update the permissions on its own so we need to setup breakpoints for that scenario as well. If we do not catch this, the malware may update the section back to <code class="language-plaintext highlighter-rouge">RWE</code> and continue running.</p><ol><li>Press <code class="language-plaintext highlighter-rouge">CTRL+G</code> to enter an expression and type in <code class="language-plaintext highlighter-rouge">VirtualProtect</code> and set a breakpoint here via <code class="language-plaintext highlighter-rouge">F2</code><br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_immdbg_07.png" /><br /></ol><h3 id="execute-malware-until-access-violation">Execute malware until access violation</h3><ol><li>To continue running the malware in the debugger press <code class="language-plaintext highlighter-rouge">F9</code></ol><p>In this case we’ll see <code class="language-plaintext highlighter-rouge">VirtualProtect</code> being hit and specifically for the address <code class="language-plaintext highlighter-rouge">00400000</code> which is the “PE header” section that it is changing from <code class="language-plaintext highlighter-rouge">R</code> to <code class="language-plaintext highlighter-rouge">RW</code> (and a second call later to revert it back to <code class="language-plaintext highlighter-rouge">R</code>)<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_immdbg_08.png" /><br /></p><p>The third time we hit <code class="language-plaintext highlighter-rouge">F9</code> we will get an Access Violation as it attempts to pass control to the <code class="language-plaintext highlighter-rouge">UPX0</code> section and begin executing code (the landing point address should be our true OEP). The violation occurred since we manually set the section to not be able to execute and this is being enforced by DEP.<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_immdbg_09.png" /><br /></p><h3 id="dumping-memory-to-file-via-ollydumpex-plugin">Dumping memory to file via OllyDumpEx plugin</h3><p><em>NOTE: If you don’t have the plugin you can download it from <a href="https://low-priority.appspot.com/ollydumpex/">OllyDumpEx</a>.</em></p><p>At this point, the <code class="language-plaintext highlighter-rouge">UPX</code> decoding is complete and we can dump memory to disk. Upon dumping memory to disk the Import Table will still be broken and we’ll need to fix this via an import table recovery tool.</p><ol><li>Use Plugins-&gt;OllyDumpEx-&gt;Dump process to save memory to disk<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_immdbg_10.png" /><li>Click “Get EIP as OEP” and then click “Dump” to save to a file<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_immdbg_11.png" /></ol><p><strong>NOTE: Do not close Immunity Debugger! Leave it running as it is still needed by the ImportRec tool to patch the file in the next step</strong></p><h3 id="fix-import-table-via-importrec">Fix Import Table via ImportRec</h3><p><a href="https://www.aldeid.com/wiki/ImpREC">Import REConstructor</a> is a tool that can scan the running binary in your debugger for all calls to system functions and reconstruct the import table as a patch to the dumped file. In this process it will also create a new section in the file called <code class="language-plaintext highlighter-rouge">.mackt</code></p><ol><li><p>Open Import REConstructor and attach to the active malware binary process that is still running in Immunity Debugger and then click “Get Imports”<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_imprec_01.png" /></p><li><p>Finally, click “Fix Dump” and select the dumped file on disk as a result of using the OllyDumpEx plugin.<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_imprec_02.png" /></p></ol><p>At this point, the Import Table should be patched and ready for additional analysis.</p><h4 id="functions-back-in-the-import-table">Functions back in the import table</h4><p>When the resulting binary is now pulled into IDA you’ll see quite a few more system functions show up from the newly patched Import Table.<br /> <img data-proofer-ignore data-src="https://tdmathison.github.io/assets/img/blogging/unpacking_ida_01.png" /></p><h4 id="additional-notes">Additional notes</h4><p>You will find a new section created called <code class="language-plaintext highlighter-rouge">.mackt</code>. This is created by the Import REconstructor tool as part of the patching of the Import Table. This section needs to stay here as if you try to delete it, the Import Table will also disappear along with it.</p><p>As for the <code class="language-plaintext highlighter-rouge">UPX1</code> section where the original packed code is, that can be deleted completly from CFF Explorer -&gt; Delete Section (Header and Data) without impact. This may not be the case for every sample though.</p><p>While you get recovery of all the code needed to continue analysis, you will not get full recovery of the names of the original sections (<code class="language-plaintext highlighter-rouge">.text</code>, <code class="language-plaintext highlighter-rouge">.rdata</code>, <code class="language-plaintext highlighter-rouge">.data</code>, <code class="language-plaintext highlighter-rouge">.rsrc</code>) as you would with the original packer tool performing the reversal. However, this does not stop further analysis in any way.</p><h2 id="conclusion">Conclusion</h2><p>This is one of several methods to unpack a packed binary to continue analysis. This method should work for many pieces of malware but as they get more complicated this would be one step of many (multiple encodings, further encryption, other anti-analysis and debugging tricks that need to be addressed along the way and more).</p><p>Continue reading with <a href="https://www.travismathison.com/posts/Manually-unpacking-malware-part2/">Manually Unpacking Malware (part 2)</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/malware-analysis/'>Malware-Analysis</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/malware/" class="post-tag no-text-decoration" >malware</a> <a href="/tags/packers/" class="post-tag no-text-decoration" >packers</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Manually Unpacking Malware - Travis Mathison&url=https://tdmathison.github.io/posts/Manually-unpacking-malware/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://tdmathison.github.io/posts/Manually-unpacking-malware/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Hex-Rays-IDA-Tips-and-Tricks/">Hex-Rays IDA Tips and Tricks</a><li><a href="/posts/Npm_Coa_203_DanaBot_Dropper/">NPM COA@2.0.3 DanaBot Dropper</a><li><a href="/posts/MalwareReport-CTS/">Malware Report: CTS</a><li><a href="/posts/Resolving-IAT-with-AGDCservices-scripts/">Resolving IAT with AGDCservices Scripts</a><li><a href="/posts/Finding-the-start-of-Emotet-malware-in-MFC-app/">Finding the start of Emotet malware in MFC app</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/penetration-testing/">penetration-testing</a> <a class="post-tag" href="/tags/assembly/">assembly</a> <a class="post-tag" href="/tags/exploit-development/">exploit-development</a> <a class="post-tag" href="/tags/ida/">ida</a> <a class="post-tag" href="/tags/shellcode/">shellcode</a> <a class="post-tag" href="/tags/slae32/">slae32</a> <a class="post-tag" href="/tags/x86/">x86</a> <a class="post-tag" href="/tags/debugging/">debugging</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Manually-unpacking-malware-part2/"><div class="card-body"> <span class="timeago small" >Nov 30, 2020<i class="unloaded">2020-11-30T15:34:00-08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Manually Unpacking Malware (part 2)</h3><div class="text-muted small"><p> Intro This is a follow on to the first post on this, Manually Unpacking Malware, where I talked about a way to break on the real entry point of a packed malware sample. This is a second technique ...</p></div></div></a></div><div class="card"> <a href="/posts/PEB_TEB_TIB-Structure-Offsets/"><div class="card-body"> <span class="timeago small" >Feb 5, 2021<i class="unloaded">2021-02-05T11:10:00-08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PEB/TEB/TIB Structure Offsets</h3><div class="text-muted small"><p> Intro This is really more of a reference table post to show the PEB/TEB/TIB structure notable offsets that are commonly seen in malware as it performs references after fetching the Process Environm...</p></div></div></a></div><div class="card"> <a href="/posts/Searching-IAT-for-DLL/"><div class="card-body"> <span class="timeago small" >Mar 29, 2021<i class="unloaded">2021-03-29T10:34:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Searching IAT for DLLs</h3><div class="text-muted small"><p> Intro With a given binary it is very simple to view the Import Address Table (IAT) and see what DLLs it imports and further, what functions are used within those DLLs. In my case, I needed to do t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Digging-into-obfuscated-excel-formula-code/" class="btn btn-outline-primary" prompt="Older"><p>Digging into obfuscated excel formula code</p></a> <a href="/posts/Manually-unpacking-malware-part2/" class="btn btn-outline-primary" prompt="Newer"><p>Manually Unpacking Malware (part 2)</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://tdmathison.github.io/posts/Manually-unpacking-malware/'; this.page.identifier = '/posts/Manually-unpacking-malware/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://tdmathison.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/ciph34block">Travis Mathison</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/penetration-testing/">penetration testing</a> <a class="post-tag" href="/tags/assembly/">assembly</a> <a class="post-tag" href="/tags/exploit-development/">exploit development</a> <a class="post-tag" href="/tags/ida/">ida</a> <a class="post-tag" href="/tags/shellcode/">shellcode</a> <a class="post-tag" href="/tags/slae32/">slae32</a> <a class="post-tag" href="/tags/x86/">x86</a> <a class="post-tag" href="/tags/debugging/">debugging</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-MXD056XG1T"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-MXD056XG1T'); }); </script>
